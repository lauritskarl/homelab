services:
    ts-gitea:
        image: tailscale/tailscale:latest
        container_name: ts-gitea
        hostname: gitea
        environment:
            - TS_AUTHKEY=$TS_AUTHKEY
            - TS_STATE_DIR=/var/lib/tailscale
            - TS_USERSPACE=false
            - TS_SERVE_CONFIG=/config/serve-config.json
        volumes:
            - $PWD/data/ts-gitea/state:/var/lib/tailscale
            - $PWD/data/ts-gitea/config:/config
        devices:
            - /dev/net/tun:/dev/net/tun
        cap_add:
            - net_admin
        restart: unless-stopped
    gitea:
        image: docker.gitea.com/gitea:1.24.2
        container_name: gitea
        network_mode: service:ts-gitea
        depends_on:
            - ts-gitea
        environment:
            - USER_UID=1000
            - USER_GID=1000
        volumes:
            - $PWD/data/gitea:/data
            - /etc/timezone:/etc/timezone:ro
            - /etc/localtime:/etc/localtime:ro
        restart: unless-stopped
