services:
    ts-searxng:
        image: docker.io/tailscale/tailscale:latest
        container_name: ts-searxng
        hostname: searxng
        environment:
            - TS_AUTHKEY=$TS_AUTHKEY
            - TS_STATE_DIR=/var/lib/tailscale
            - TS_USERSPACE=false
            - TS_SERVE_CONFIG=/config/serve-config.json
        volumes:
            - ts-searxng-state:/var/lib/tailscale
            - ./serve-config.json:/config/serve-config.json
        devices:
            - /dev/net/tun:/dev/net/tun
        cap_add:
            - net_admin
        restart: unless-stopped

    searxng:
        image: docker.io/searxng/searxng:latest
        container_name: searxng
        network_mode: service:ts-searxng
        depends_on:
            - ts-searxng
        volumes:
            - searxng-config:/etc/searxng/
            - searxng-data:/var/cache/searxng/
        restart: unless-stopped

volumes:
    ts-searxng-state:
        name: ts-searxng-state
    searxng-config:
        name: searxng-config
    searxng-data:
        name: searxng-data
